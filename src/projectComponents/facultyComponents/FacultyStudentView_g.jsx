const apiValue = {
  details: {
    3122235001110: {
      name: "Saipranav M",
      attendance: {
        ELE2H22A: {
          "lecture.1": {
            date: 20250616,
            time: 222843,
            present: 1,
          },
          "lecture.2": {
            date: 20250616,
            time: 224223,
            present: 0,
          },
          "lecture.3": {
            date: 20250616,
            time: 224313,
            present: 1,
          },
          "lecture.4": {
            date: 20250616,
            time: 234617,
            present: 1,
          },
          "lecture.5": {
            date: 20250616,
            time: 234729,
            present: 1,
          },
          "lecture.6": {
            date: 20250617,
            time: 151,
            present: 1,
          },
          "lecture.7": {
            date: 20250617,
            time: 646,
            present: 0,
          },
          "lecture.8": {
            date: 20250617,
            time: 1212,
            present: 1,
          },
          "lecture.9": {
            date: 20250617,
            time: 1415,
            present: 1,
          },
          "lecture.10": {
            date: 20250617,
            time: 2318,
            present: 1,
          },
          "lecture.11": {
            date: 20250617,
            time: 1401,
            present: 0,
          },
          "lecture.12": {
            date: 20250617,
            time: 1402,
            present: 1,
          },
          "lecture.13": {
            date: 20250617,
            time: 1409,
            present: 0,
          },
          "lecture.14": {
            date: 20250617,
            time: 1410,
            present: 0,
          },
          "lecture.15": {
            date: 20250617,
            time: 1410,
            present: 0,
          },
          "lecture.16": {
            date: 20250617,
            time: 1416,
            present: 0,
          },
          "lecture.17": {
            date: 20250617,
            time: 1417,
            present: 1,
          },
          "lecture.18": {
            date: 20250618,
            time: 1839,
            present: 1,
          },
        },
        CSE2701B: {
          "lecture.1": {
            date: 20250617,
            time: 34,
            present: 1,
          },
          "lecture.2": {
            date: 20250617,
            time: 36,
            present: 1,
          },
          "lecture.3": {
            date: 20250617,
            time: 1110,
            present: 1,
          },
          "lecture.4": {
            date: 20250617,
            time: 1111,
            present: 1,
          },
          "lecture.5": {
            date: 20250617,
            time: 1112,
            present: 1,
          },
          "lecture.6": {
            date: 20250617,
            time: 1256,
            present: 1,
          },
          "lecture.7": {
            date: 20250617,
            time: 1300,
            present: 1,
          },
          "lecture.8": {
            date: 20250617,
            time: 1304,
            present: 1,
          },
          "lecture.9": {
            date: 20250618,
            time: 1904,
            present: 1,
          },
        },
      },
    },
    3122235001087: {
      name: "Murari Sreekumar",
      attendance: {
        ELE2H22A: {
          "lecture.1": {
            date: 20250616,
            time: 222843,
            present: 0,
          },
          "lecture.2": {
            date: 20250616,
            time: 224223,
            present: 0,
          },
          "lecture.3": {
            date: 20250616,
            time: 224313,
            present: 0,
          },
          "lecture.4": {
            date: 20250616,
            time: 234617,
            present: 1,
          },
          "lecture.5": {
            date: 20250616,
            time: 234729,
            present: 0,
          },
          "lecture.6": {
            date: 20250617,
            time: 151,
            present: 0,
          },
          "lecture.7": {
            date: 20250617,
            time: 646,
            present: 0,
          },
          "lecture.8": {
            date: 20250617,
            time: 1212,
            present: 0,
          },
          "lecture.9": {
            date: 20250617,
            time: 1415,
            present: 0,
          },
          "lecture.10": {
            date: 20250617,
            time: 2318,
            present: 0,
          },
          "lecture.11": {
            date: 20250617,
            time: 1401,
            present: 0,
          },
          "lecture.12": {
            date: 20250617,
            time: 1402,
            present: 0,
          },
          "lecture.13": {
            date: 20250617,
            time: 1409,
            present: 0,
          },
          "lecture.14": {
            date: 20250617,
            time: 1410,
            present: 0,
          },
          "lecture.15": {
            date: 20250617,
            time: 1410,
            present: 1,
          },
          "lecture.16": {
            date: 20250617,
            time: 1416,
            present: 1,
          },
          "lecture.17": {
            date: 20250617,
            time: 1417,
            present: 0,
          },
          "lecture.18": {
            date: 20250618,
            time: 1839,
            present: 1,
          },
        },
        CSE2701B: {
          "lecture.1": {
            date: 20250617,
            time: 34,
            present: 0,
          },
          "lecture.2": {
            date: 20250617,
            time: 36,
            present: 0,
          },
          "lecture.3": {
            date: 20250617,
            time: 1110,
            present: 0,
          },
          "lecture.4": {
            date: 20250617,
            time: 1111,
            present: 0,
          },
          "lecture.5": {
            date: 20250617,
            time: 1112,
            present: 0,
          },
          "lecture.6": {
            date: 20250617,
            time: 1256,
            present: 1,
          },
          "lecture.7": {
            date: 20250617,
            time: 1300,
            present: 1,
          },
          "lecture.8": {
            date: 20250617,
            time: 1304,
            present: 0,
          },
          "lecture.9": {
            date: 20250618,
            time: 1904,
            present: 1,
          },
        },
      },
    },
  },
  message: "mentees attendance retrieved sucessfully",
  status: "S",
};

import { useState } from "react";
import { Button } from "@/components/ui/button";
import { Contact } from "lucide-react";

function FacultyStudentView_g() {
  const apiValue = {
    details: {
      3122235001110: {
        name: "Saipranav M",
        attendance: {
          ELE2H22A: {
            "lecture.1": { present: 1 },
            "lecture.2": { present: 0 },
            "lecture.3": { present: 1 },
            // ...
          },
          CSE2701B: {
            "lecture.1": { present: 1 },
            // ...
          },
        },
      },
      3122235001087: {
        name: "Murari Sreekumar",
        attendance: {
          ELE2H22A: {
            "lecture.1": { present: 0 },
            // ...
          },
          CSE2701B: {
            "lecture.1": { present: 0 },
            // ...
          },
        },
      },
    },
  };

  function parseAttendanceData(api) {
    const result = [];

    const students = api.details;

    for (const regNumber in students) {
      const student = students[regNumber];
      const { name, attendance } = student;

      const courses = [];
      let totalAttended = 0;
      let totalClasses = 0;

      for (const subject in attendance) {
        const lectures = attendance[subject];
        const subjectTotal = Object.keys(lectures).length;
        const subjectAttended = Object.values(lectures).filter(
          (lec) => lec.present === 1
        ).length;

        totalAttended += subjectAttended;
        totalClasses += subjectTotal;

        courses.push({
          name: subject,
          attended: subjectAttended,
          total: subjectTotal,
        });
      }

      const percentage = ((totalAttended / totalClasses) * 100).toFixed(2);

      result.push({
        name,
        registerNumber: regNumber,
        digitalId: regNumber,
        department: "CSE",
        year: "III",
        courses,
        percentage,
      });
    }

    return result;
  }

  const allStudents = parseAttendanceData(apiValue);
  const [expandedIndex, setExpandedIndex] = useState(null);

  return (
    <div className="space-y-6 p-6 max-w-5xl mx-auto">
      {allStudents.map((student, index) => {
        const showDetails = expandedIndex === index;
        const numericPercentage = parseFloat(student.percentage);
        let badgeColor = "bg-green-400";
        if (numericPercentage < 70) badgeColor = "bg-red-500";
        else if (numericPercentage < 75) badgeColor = "bg-orange-400";

        const overallPercentage = (
          student.courses.reduce(
            (acc, course) => acc + (course.attended / course.total) * 100,
            0
          ) / student.courses.length
        ).toFixed(2);

        return (
          <div
            key={index}
            className="bg-white border rounded-2xl shadow-md p-6"
          >
            {!showDetails ? (
              <div className="flex items-center justify-between">
                <div className="flex items-center space-x-3 w-1/3 min-w-0">
                  <img
                    src="https://www.w3schools.com/howto/img_avatar.png"
                    alt="Profile"
                    className="w-16 h-16 rounded-full border border-gray-300"
                  />
                  <span className="font-semibold text-lg text-blue-700 truncate">
                    {student.name}
                  </span>
                </div>

                <div className="w-1/3 text-center">
                  <span className="text-md text-gray-600 font-medium">
                    {student.department}, {student.year}
                  </span>
                </div>

                <div className="flex items-center justify-end space-x-4 w-1/3">
                  <div
                    className={`${badgeColor} text-white font-bold text-md px-4 py-2 rounded-full text-center w-[100px]`}
                  >
                    {student.percentage}
                  </div>
                  <Button
                    variant="outline"
                    className="rounded-full text-md px-4 py-2 flex items-center space-x-2"
                    onClick={() => setExpandedIndex(index)}
                  >
                    <Contact className="w-5 h-5" />
                    <span>View Details</span>
                  </Button>
                </div>
              </div>
            ) : (
              <div className="space-y-4">
                <div className="flex justify-between items-center">
                  <div className="flex items-center gap-4">
                    <img
                      src="https://www.w3schools.com/howto/img_avatar.png"
                      alt="Profile"
                      className="w-16 h-16 rounded-full border border-gray-300"
                    />
                    <div>
                      <h2 className="text-2xl font-bold">{student.name}</h2>
                      <p className="text-blue-700 font-semibold">
                        Department:{" "}
                        <span className="text-black">{student.department}</span>
                      </p>
                      <p className="text-blue-700 font-semibold">
                        Year: <span className="text-black">{student.year}</span>
                      </p>
                      <p className="text-blue-700 font-semibold">
                        Digital ID:{" "}
                        <span className="text-black">{student.digitalId}</span>
                      </p>
                      <p className="text-blue-700 font-semibold">
                        Register Number:{" "}
                        <span className="text-black">
                          {student.registerNumber}
                        </span>
                      </p>
                    </div>
                  </div>
                </div>

                <table className="w-full text-center border mt-4">
                  <thead className="bg-blue-600 text-white">
                    <tr>
                      <th className="p-2">Course</th>
                      <th className="p-2">Attended</th>
                      <th className="p-2">Total</th>
                      <th className="p-2">%</th>
                    </tr>
                  </thead>
                  <tbody>
                    {student.courses.map((course, idx) => {
                      const percent = (
                        (course.attended / course.total) *
                        100
                      ).toFixed(1);
                      return (
                        <tr key={idx} className="border-t">
                          <td className="p-2">{course.name}</td>
                          <td className="p-2 font-semibold">
                            {course.attended}
                          </td>
                          <td className="p-2">{course.total}</td>
                          <td className="p-2 font-semibold">{percent} %</td>
                        </tr>
                      );
                    })}
                  </tbody>
                </table>

                <div className="flex justify-end mt-4 items-center">
                  <span className="text-lg font-bold mr-2">Total</span>
                  <div className="bg-green-500 text-white font-bold px-4 py-2 rounded-full">
                    {overallPercentage} %
                  </div>
                </div>

                <div className="text-right">
                  <Button
                    onClick={() => setExpandedIndex(null)}
                    variant="outline"
                  >
                    Back
                  </Button>
                </div>
              </div>
            )}
          </div>
        );
      })}
    </div>
  );
}

export default FacultyStudentView_g;
